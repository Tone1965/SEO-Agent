<!-- =====================================
<!-- INDEX.HTML - FRONTEND UI -->
<!-- ===================================== -->
<!-- This is the web interface for the SEO agent system -->
<!-- Provides a dashboard to generate websites with all 10 agents -->
<!-- Terry: Use this as your main control panel to create websites -->

<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true' }" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Agent System - Website Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#0f172a',
                            card: '#1e293b',
                            border: '#334155',
                            text: '#e2e8f0'
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .agent-card {
            transition: all 0.3s ease;
        }
        .agent-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .gradient-bg-dark {
            background: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%);
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        /* Dark mode styles */
        .dark .agent-status-indicator {
            color: #e2e8f0;
        }
        .dark .monitor-header {
            background: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%);
        }
        .dark .agent-monitor-popup {
            background: #1e293b;
            color: #e2e8f0;
        }
        .dark .monitor-tab {
            color: #94a3b8;
        }
        .dark .monitor-tab.active {
            color: #a78bfa;
            background: #0f172a;
            border-bottom-color: #a78bfa;
        }
        .dark .log-entry.success {
            background: #064e3b;
            color: #6ee7b7;
        }
        .dark .log-entry.info {
            background: #1e3a8a;
            color: #93c5fd;
        }
        .dark .log-entry.warning {
            background: #78350f;
            color: #fcd34d;
        }
        .dark .log-entry.error {
            background: #7f1d1d;
            color: #fca5a5;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark-bg min-h-screen transition-colors duration-300">
    <div x-data="seoAgentApp()" class="min-h-screen">
        <!-- Header -->
        <header class="gradient-bg dark:gradient-bg-dark text-white shadow-lg transition-all duration-300">
            <div class="container mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <i class="fas fa-robot text-3xl"></i>
                        <div>
                            <h1 class="text-2xl font-bold">SEO Agent System</h1>
                            <p class="text-blue-200 dark:text-purple-200">10 AI Agents • Complete Website Generation</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="bg-white/20 rounded-lg px-4 py-2">
                            <span class="text-sm">Websites Generated: </span>
                            <span class="font-bold" x-text="totalGenerated"></span>
                        </div>
                        <!-- Theme Toggle Button -->
                        <button @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode)" 
                                class="bg-white/20 hover:bg-white/30 rounded-lg px-4 py-2 transition-colors"
                                :title="darkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
                            <i :class="darkMode ? 'fas fa-sun' : 'fas fa-moon'" class="text-lg"></i>
                        </button>
                        <button class="bg-white/20 hover:bg-white/30 rounded-lg px-4 py-2 transition-colors">
                            <i class="fas fa-cog mr-2"></i>Settings
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-6 py-8">
            <!-- Market Scanner / Competitor Analysis Section -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-search text-purple-600 text-2xl mr-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Market Scanner & Competitor Analysis</h2>
                    <span class="ml-auto text-sm bg-purple-100 text-purple-800 px-3 py-1 rounded-full">
                        <i class="fas fa-bolt mr-1"></i>Powered by Jina.ai
                    </span>
                </div>

                <div class="space-y-4">
                    <div class="flex space-x-2">
                        <input x-model="marketSearchQuery" 
                               type="text" 
                               placeholder="Enter business name, competitor URL, or market keyword (e.g., 'plumber Birmingham')" 
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <button @click="performMarketScan()" 
                                type="button"
                                :disabled="isScanning"
                                class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors disabled:opacity-50 flex items-center">
                            <i :class="isScanning ? 'fas fa-spinner fa-spin' : 'fas fa-search'" class="mr-2"></i>
                            <span x-text="isScanning ? 'Scanning...' : 'Scan Market'"></span>
                            <span class="ml-2 text-xs">via Jina.ai</span>
                        </button>
                    </div>

                    <!-- Market Scan Results -->
                    <div x-show="marketScanResults" class="mt-4 p-6 bg-purple-50 rounded-lg">
                        <template x-if="marketScanResults">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-4 flex items-center">
                                    <i class="fas fa-chart-line mr-2 text-purple-600"></i>
                                    Market Analysis Results
                                </h4>
                                
                                <!-- Quick Stats -->
                                <div class="grid grid-cols-3 gap-4 mb-6">
                                    <div class="bg-white dark:bg-dark-bg p-4 rounded-lg text-center transition-colors duration-300">
                                        <div class="text-2xl font-bold text-purple-600" x-text="marketScanResults.competitorCount || '0'"></div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Competitors Found</div>
                                    </div>
                                    <div class="bg-white dark:bg-dark-bg p-4 rounded-lg text-center transition-colors duration-300">
                                        <div class="text-2xl font-bold text-blue-600" x-text="marketScanResults.platformCount || '0'"></div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Platforms Analyzed</div>
                                    </div>
                                    <div class="bg-white dark:bg-dark-bg p-4 rounded-lg text-center transition-colors duration-300">
                                        <div class="text-2xl font-bold text-green-600" x-text="marketScanResults.opportunityScore || '0'">%</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Opportunity Score</div>
                                    </div>
                                </div>

                                <!-- Platform Results -->
                                <div class="space-y-3">
                                    <template x-for="platform in (marketScanResults.presence || [])" :key="platform.query">
                                        <div class="bg-white p-4 rounded-lg">
                                            <h5 class="font-medium text-gray-800 mb-2" x-text="platform.query"></h5>
                                            <div class="space-y-1">
                                                <template x-for="result in platform.results.slice(0, 3)" :key="result.url">
                                                    <div class="text-sm text-gray-600">
                                                        • <a :href="result.url" target="_blank" class="text-blue-600 hover:underline" x-text="result.title"></a>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>
                                    </template>
                                </div>

                                <!-- Use for Website Generation -->
                                <div class="mt-4 text-center">
                                    <button @click="useMarketDataForWebsite()" 
                                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition-colors">
                                        <i class="fas fa-arrow-down mr-2"></i>
                                        Use This Data for Website Generation
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Website Generation Form -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-plus-circle text-blue-600 text-2xl mr-3"></i>
                    <h2 class="text-2xl font-bold text-gray-800">Generate New Website</h2>
                    <span class="ml-auto text-sm bg-blue-100 text-blue-800 px-3 py-1 rounded-full">
                        <i class="fas fa-robot mr-1"></i>10 AI Agents
                    </span>
                </div>

                <form @submit.prevent="generateWebsite()" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Business Type -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="fas fa-building mr-2"></i>Business Type
                            </label>
                            <input x-model="formData.businessType" type="text" placeholder="e.g., Plumber, HVAC, Restaurant" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <!-- Location -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="fas fa-map-marker-alt mr-2"></i>Location
                            </label>
                            <input x-model="formData.location" type="text" placeholder="e.g., Birmingham, AL" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <!-- Target Keywords -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                <i class="fas fa-tags mr-2"></i>Target Keywords
                            </label>
                            <input x-model="formData.keywords" type="text" placeholder="e.g., emergency plumber, 24 hour service, drain cleaning" 
                                   class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">Keywords will be enhanced by market scan data</p>
                        </div>

                        <!-- Market Intelligence Integration -->
                        <div class="md:col-span-2" x-show="marketScanResults">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-sm font-semibold text-blue-800 mb-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Market Intelligence Applied
                                </h4>
                                <p class="text-sm text-blue-700">
                                    Using data from <span x-text="marketScanResults?.platformCount || '0'"></span> platforms 
                                    and <span x-text="marketScanResults?.competitorCount || '0'"></span> competitors
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Button -->
                    <div class="flex justify-center">
                        <button type="submit" :disabled="isGenerating || !formData.businessType || !formData.location" 
                                class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed">
                            <span x-show="!isGenerating" class="flex items-center">
                                <i class="fas fa-rocket mr-2"></i>
                                Generate AI-Powered Website
                                <span class="ml-2 text-xs opacity-80">with Jina.ai</span>
                            </span>
                            <span x-show="isGenerating" class="flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                AI Agents Working...
                            </span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Progress Section -->
            <div x-show="isGenerating" class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-cogs text-blue-600 text-2xl mr-3"></i>
                    <h3 class="text-xl font-bold text-gray-800">AI Agents Working</h3>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-sm font-medium text-gray-700" x-text="currentAgent"></span>
                        <span class="text-sm text-gray-500" x-text="`${Math.round(progress)}%`"></span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="progress-bar bg-gradient-to-r from-blue-500 to-purple-500 h-3 rounded-full" 
                             :style="`width: ${progress}%`"></div>
                    </div>
                </div>

                <div class="text-center text-gray-600">
                    <p x-text="progressMessage"></p>
                </div>
            </div>

            <!-- AI Agents Overview -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-users text-blue-600 text-2xl mr-3"></i>
                    <h3 class="text-xl font-bold text-gray-800">10 AI Agents System</h3>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    <template x-for="agent in agents" :key="agent.id">
                        <div class="agent-card bg-gradient-to-br from-blue-50 to-purple-50 rounded-lg p-4 border border-blue-100">
                            <div class="text-center">
                                <i :class="agent.icon" class="text-2xl text-blue-600 mb-2"></i>
                                <h4 class="font-semibold text-gray-800 text-sm mb-1" x-text="agent.name"></h4>
                                <p class="text-xs text-gray-600" x-text="agent.description"></p>
                                <div class="mt-2">
                                    <span :class="agent.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600'" 
                                          class="inline-block px-2 py-1 rounded-full text-xs font-medium">
                                        <i :class="agent.status === 'active' ? 'fas fa-check' : 'fas fa-clock'" class="mr-1"></i>
                                        <span x-text="agent.status === 'active' ? 'Ready' : 'Standby'"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Results Section -->
            <div x-show="results.length > 0" class="bg-white rounded-xl shadow-lg p-8">
                <div class="flex items-center mb-6">
                    <i class="fas fa-trophy text-yellow-500 text-2xl mr-3"></i>
                    <h3 class="text-xl font-bold text-gray-800">Generated Websites</h3>
                </div>

                <div class="space-y-4">
                    <template x-for="result in results" :key="result.id">
                        <div class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h4 class="font-semibold text-lg text-gray-800" x-text="result.businessType"></h4>
                                    <p class="text-gray-600" x-text="result.location"></p>
                                </div>
                                <div class="text-right">
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                        <i class="fas fa-check mr-1"></i>Complete
                                    </span>
                                    <p class="text-sm text-gray-500 mt-1" x-text="result.generatedAt"></p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600" x-text="result.stats.pages"></div>
                                    <div class="text-sm text-gray-600">Pages</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600" x-text="result.stats.keywords"></div>
                                    <div class="text-sm text-gray-600">Keywords</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-600" x-text="result.stats.content"></div>
                                    <div class="text-sm text-gray-600">Content Pieces</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-600" x-text="result.stats.seoScore"></div>
                                    <div class="text-sm text-gray-600">SEO Score</div>
                                </div>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button @click="previewWebsite(result.taskId)" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    <i class="fas fa-eye mr-1"></i>Preview
                                </button>
                                <button @click="downloadWebsite(result.taskId)" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    <i class="fas fa-download mr-1"></i>Download
                                </button>
                                <button @click="deployWebsite(result)" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">
                                    <i class="fas fa-rocket mr-1"></i>Deploy
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-8 mt-16">
            <div class="container mx-auto px-6 text-center">
                <div class="flex items-center justify-center mb-4">
                    <i class="fas fa-robot text-2xl mr-3"></i>
                    <span class="text-xl font-bold">SEO Agent System</span>
                </div>
                <p class="text-gray-400">Powered by 10 AI Agents • Claude Sonnet 4 • OpenAI GPT-4</p>
                <div class="mt-4 space-x-6">
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">Documentation</a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">API Reference</a>
                    <a href="#" class="text-gray-400 hover:text-white transition-colors">Support</a>
                </div>
            </div>
        </footer>
    </div>

    <script>
        function seoAgentApp() {
            return {
                formData: {
                    businessType: '',
                    location: '',
                    keywords: '',
                    competitorUrl: ''
                },
                marketSearchQuery: '',
                marketScanResults: null,
                isScanning: false,
                competitorData: null,
                competitorResults: null,
                isAnalyzing: false,
                isGenerating: false,
                progress: 0,
                currentAgent: 'Waiting to start...',
                progressMessage: 'Ready to generate your website',
                totalGenerated: parseInt(localStorage.getItem('totalGenerated') || '0'),
                results: [],
                agents: [
                    {
                        id: 1,
                        name: 'Market Scanner',
                        description: 'Analyzes competition',
                        icon: 'fas fa-search',
                        status: 'ready'
                    },
                    {
                        id: 2,
                        name: 'Opportunity Analyzer', 
                        description: 'Finds opportunities',
                        icon: 'fas fa-bullseye',
                        status: 'ready'
                    },
                    {
                        id: 3,
                        name: 'Blueprint Generator',
                        description: 'Creates site blueprint',
                        icon: 'fas fa-drafting-compass',
                        status: 'ready'
                    },
                    {
                        id: 4,
                        name: 'Content Architect',
                        description: 'Designs content structure',
                        icon: 'fas fa-sitemap',
                        status: 'ready'
                    },
                    {
                        id: 5,
                        name: 'Content Generator',
                        description: 'Writes all content',
                        icon: 'fas fa-pen-fancy',
                        status: 'ready'
                    },
                    {
                        id: 6,
                        name: 'SEO Optimizer',
                        description: 'Optimizes for search',
                        icon: 'fas fa-chart-line',
                        status: 'ready'
                    },
                    {
                        id: 7,
                        name: 'Design System',
                        description: 'Creates modern designs',
                        icon: 'fas fa-palette',
                        status: 'ready'
                    },
                    {
                        id: 8,
                        name: 'Code Generator',
                        description: 'Builds the website',
                        icon: 'fas fa-code',
                        status: 'ready'
                    },
                    {
                        id: 9,
                        name: 'Quality Assurance',
                        description: 'Tests everything',
                        icon: 'fas fa-check-double',
                        status: 'ready'
                    },
                    {
                        id: 10,
                        name: 'Deployment Agent',
                        description: 'Launches the site',
                        icon: 'fas fa-rocket',
                        status: 'ready'
                    }
                ],

                async generateWebsite() {
                    if (!this.formData.businessType || !this.formData.location || !this.formData.keywords) {
                        alert('Please fill in all required fields');
                        return;
                    }

                    this.isGenerating = true;
                    this.progress = 0;
                    this.currentAgent = 'Initializing AI agents...';
                    this.progressMessage = 'Setting up the generation process';

                    try {
                        // Prepare data with all required fields
                        const requestData = {
                            business_type: this.formData.businessType,
                            location: this.formData.location,
                            target_keywords: this.formData.keywords.split(',').map(k => k.trim()),
                            competition_level: this.marketScanResults ? 
                                (this.marketScanResults.competitorCount > 10 ? 'high' : 
                                 this.marketScanResults.competitorCount > 5 ? 'medium' : 'low') : 'medium',
                            budget_range: '$3,000-$5,000',
                            timeline: '2-4 weeks',
                            competitor_url: this.formData.competitorUrl || null
                        };

                        // Start generation
                        const response = await fetch('/api/generate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(requestData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            // Poll for progress
                            await this.pollProgress(result.task_id);
                        } else {
                            throw new Error(result.error);
                        }

                    } catch (error) {
                        alert('Error generating website: ' + error.message);
                        this.isGenerating = false;
                    }
                },

                async pollProgress(taskId) {
                    const agentNames = [
                        'Market Scanner Agent',
                        'Opportunity Analyzer Agent', 
                        'Blueprint Generator Agent',
                        'Content Architect Agent',
                        'Content Generator Agent',
                        'SEO Optimizer Agent',
                        'Design System Agent',
                        'Code Generator Agent',
                        'Quality Assurance Agent',
                        'Deployment Agent'
                    ];

                    let currentAgentIndex = 0;

                    const checkProgress = async () => {
                        try {
                            const response = await fetch(`/api/status/${taskId}`);
                            const status = await response.json();

                            if (status.state === 'PENDING') {
                                this.currentAgent = 'Waiting for agents to start...';
                                this.progressMessage = 'Your request is in the queue';
                            } else if (status.state === 'PROGRESS') {
                                const progressPercent = (status.current / status.total) * 100;
                                this.progress = progressPercent;
                                this.currentAgent = agentNames[currentAgentIndex] || 'Processing...';
                                this.progressMessage = status.status || 'Working on your website...';
                                
                                if (progressPercent > (currentAgentIndex + 1) * 10) {
                                    currentAgentIndex++;
                                }
                            } else if (status.state === 'SUCCESS') {
                                this.progress = 100;
                                this.currentAgent = 'Complete!';
                                this.progressMessage = 'Your website has been generated successfully';
                                
                                // Add to results with real data
                                const result = status.result || {};
                                const newResult = {
                                    id: Date.now(),
                                    taskId: taskId,
                                    businessType: this.formData.businessType,
                                    location: this.formData.location,
                                    generatedAt: new Date().toLocaleString(),
                                    success: result.success || false,
                                    downloadReady: result.download_ready || false,
                                    stats: {
                                        pages: result.website_files?.files_created?.length || 0,
                                        keywords: result.project_config?.target_keywords?.length || 0,
                                        content: result.agent_results ? Object.keys(result.agent_results).length : 0,
                                        seoScore: result.quality_score || 0
                                    }
                                };
                                
                                this.results.unshift(newResult);
                                this.totalGenerated++;
                                localStorage.setItem('totalGenerated', this.totalGenerated.toString());
                                
                                setTimeout(() => {
                                    this.isGenerating = false;
                                }, 2000);
                                
                                return;
                            } else {
                                throw new Error(status.status || 'Unknown error');
                            }

                            // Continue polling
                            setTimeout(checkProgress, 2000);

                        } catch (error) {
                            console.error('Error checking progress:', error);
                            this.isGenerating = false;
                            alert('Error during generation: ' + error.message);
                        }
                    };

                    checkProgress();
                },

                async previewWebsite(taskId) {
                    try {
                        const response = await fetch(`/api/preview/${taskId}`);
                        const result = await response.json();
                        
                        if (result.success) {
                            // Create preview modal or new window
                            const previewContent = result.content_preview;
                            const homepage = previewContent.homepage;
                            
                            let previewText = `Website Preview for ${result.project_config.business_type} in ${result.project_config.location}\n\n`;
                            
                            if (homepage && typeof homepage === 'object') {
                                previewText += `Headline: ${homepage.hero_headline || 'N/A'}\n`;
                                previewText += `Subheadline: ${homepage.hero_subheadline || 'N/A'}\n`;
                                previewText += `Value Proposition: ${homepage.value_proposition || 'N/A'}\n\n`;
                                
                                if (homepage.services_list) {
                                    previewText += 'Services:\n';
                                    homepage.services_list.forEach((service, index) => {
                                        previewText += `${index + 1}. ${service.name || service}: ${service.description || ''}\n`;
                                    });
                                }
                            } else {
                                previewText += `Content: ${homepage}\n`;
                            }
                            
                            alert(previewText);
                        } else {
                            alert('Preview not available: ' + result.error);
                        }
                    } catch (error) {
                        alert('Error loading preview: ' + error.message);
                    }
                },

                async downloadWebsite(taskId) {
                    try {
                        this.currentAgent = 'Preparing download...';
                        
                        const response = await fetch(`/api/download/${taskId}`);
                        
                        if (response.ok) {
                            // Create download link
                            const blob = await response.blob();
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `website_${taskId}.zip`;
                            document.body.appendChild(a);
                            a.click();
                            window.URL.revokeObjectURL(url);
                            document.body.removeChild(a);
                            
                            alert('Website downloaded successfully!');
                        } else {
                            const error = await response.json();
                            alert('Download failed: ' + error.error);
                        }
                    } catch (error) {
                        alert('Error downloading website: ' + error.message);
                    }
                },

                async deployWebsite(result) {
                    if (!result.downloadReady) {
                        alert('Website must be successfully generated before deployment.');
                        return;
                    }
                    
                    // For now, show deployment instructions
                    const instructions = `Deployment Instructions:

1. Download the website files using the Download button
2. Extract the ZIP file to your web server
3. Upload files to your hosting provider
4. Configure your domain to point to the files

For advanced deployment:
- Use our Docker setup for full deployment
- Deploy to Digital Ocean, AWS, or other cloud providers
- Contact support for automated deployment options

The website is ready for deployment!`;
                    
                    alert(instructions);
                },

                async performMarketScan() {
                    if (!this.marketSearchQuery) {
                        alert('Please enter a business name, competitor, or market keyword');
                        return;
                    }
                    
                    this.isScanning = true;
                    this.marketScanResults = null;
                    
                    try {
                        // Use the simple search endpoint for fast results
                        const response = await fetch('/api/search-simple', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ query: this.marketSearchQuery })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            // Process results into market scan format
                            this.marketScanResults = {
                                competitorCount: data.count || 0,
                                platformCount: 1, // Simple search uses 1 platform
                                opportunityScore: Math.min(100, 100 - (data.count * 5)), // Less competition = higher opportunity
                                presence: [{
                                    query: `Search results for: ${this.marketSearchQuery}`,
                                    results: data.results || []
                                }],
                                raw_data: data
                            };
                        } else {
                            alert('Market scan failed: ' + (data.error || 'Unknown error'));
                        }
                    } catch (error) {
                        alert('Error performing market scan: ' + error.message);
                    } finally {
                        this.isScanning = false;
                    }
                },

                useMarketDataForWebsite() {
                    if (!this.marketScanResults) return;
                    
                    // Extract business type and location from the search query
                    const parts = this.marketSearchQuery.split(' ');
                    
                    // Try to identify location (usually last 1-2 words if they're capitalized)
                    let location = '';
                    let businessType = this.marketSearchQuery;
                    
                    // Simple heuristic: if last word is a state abbreviation or city name
                    if (parts.length >= 2) {
                        const lastWord = parts[parts.length - 1];
                        const secondLastWord = parts[parts.length - 2];
                        
                        // Check for state abbreviation pattern (2 capital letters)
                        if (lastWord.match(/^[A-Z]{2}$/)) {
                            location = `${secondLastWord} ${lastWord}`;
                            businessType = parts.slice(0, -2).join(' ');
                        } else if (lastWord[0] === lastWord[0].toUpperCase()) {
                            location = lastWord;
                            businessType = parts.slice(0, -1).join(' ');
                        }
                    }
                    
                    // Populate form with extracted data
                    this.formData.businessType = businessType || this.marketSearchQuery;
                    this.formData.location = location || 'Your City, State';
                    
                    // Extract keywords from competitor results
                    const keywords = [];
                    if (this.marketScanResults.presence) {
                        this.marketScanResults.presence.forEach(platform => {
                            platform.results.slice(0, 3).forEach(result => {
                                // Extract keywords from titles
                                const words = result.title.toLowerCase().split(' ');
                                words.forEach(word => {
                                    if (word.length > 4 && !keywords.includes(word)) {
                                        keywords.push(word);
                                    }
                                });
                            });
                        });
                    }
                    
                    this.formData.keywords = keywords.slice(0, 5).join(', ');
                    
                    // Scroll to generation form
                    document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
                },

                async scrapeCompetitor() {
                    if (!this.formData.competitorUrl) {
                        alert('Please enter a competitor name or URL');
                        return;
                    }
                    
                    this.isAnalyzing = true;
                    this.competitorData = 'Searching across Google, Bing, Facebook, Reddit, Yelp, BBB...';
                    this.competitorResults = null;
                    
                    try {
                        const response = await fetch('/api/scrape', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ url: this.formData.competitorUrl })
                        });
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.competitorResults = data;
                            this.competitorData = data.summary;
                        } else {
                            this.competitorData = 'Error: ' + data.error;
                        }
                    } catch (error) {
                        this.competitorData = 'Error searching: ' + error.message;
                    } finally {
                        this.isAnalyzing = false;
                    }
                }
            }
        }
    </script>
</body>
</html>